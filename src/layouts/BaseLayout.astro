---
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

export interface Props {
  title?: string;
  description?: string;
  currentPath?: string;
}

const { 
  title = SITE_TITLE, 
  description = SITE_DESCRIPTION,
  currentPath = Astro.url.pathname
} = Astro.props;

const fullTitle = title === SITE_TITLE ? title : `${title} - ${SITE_TITLE}`;
---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    
    <!-- Theme Script (inline to prevent flash) -->
    <script is:inline>
      (function() {
        const theme = localStorage.getItem('theme') || 
          (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- Meta tags -->
    <meta name="generator" content={Astro.generator} />
  </head>
  
  <body class="bg-background-offset dark:bg-background-dark font-display text-text-primary dark:text-white antialiased flex flex-col min-h-screen transition-colors duration-200">
    <Header currentPath={currentPath} />
    
    <main class="flex-grow">
      <slot />
    </main>
    
    <Footer />
    
    <!-- Theme management script -->
    <script is:inline>
      // Theme management script
      class ThemeManager {
        constructor() {
          this.theme = this.getStoredTheme() || this.getSystemTheme();
          this.init();
        }

        init() {
          this.applyTheme(this.theme);
          this.setupToggleListeners();
        }

        getStoredTheme() {
          if (typeof localStorage !== 'undefined') {
            return localStorage.getItem('theme');
          }
          return null;
        }

        getSystemTheme() {
          if (typeof window !== 'undefined' && window.matchMedia) {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          }
          return 'light';
        }

        applyTheme(theme) {
          const root = document.documentElement;
          
          if (theme === 'dark') {
            root.classList.add('dark');
          } else {
            root.classList.remove('dark');
          }

          // Update toggle buttons
          this.updateToggleButtons(theme);
          
          // Store theme preference
          if (typeof localStorage !== 'undefined') {
            localStorage.setItem('theme', theme);
          }
        }

        updateToggleButtons(theme) {
          const toggleButtons = document.querySelectorAll('[data-theme-toggle]');
          toggleButtons.forEach(button => {
            const icon = button.querySelector('.theme-icon');
            if (icon) {
              icon.textContent = theme === 'dark' ? 'light_mode' : 'dark_mode';
            }
          });
        }

        toggle() {
          this.theme = this.theme === 'dark' ? 'light' : 'dark';
          this.applyTheme(this.theme);
        }

        setupToggleListeners() {
          document.addEventListener('click', (e) => {
            if (e.target.closest('[data-theme-toggle]')) {
              e.preventDefault();
              this.toggle();
            }
          });
        }
      }

      // Initialize theme manager when DOM is ready
      if (typeof document !== 'undefined') {
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => {
            window.themeManager = new ThemeManager();
          });
        } else {
          window.themeManager = new ThemeManager();
        }
      }
    </script>
  </body>
</html>