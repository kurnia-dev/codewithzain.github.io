---
import ArticleCard from "./ArticleCard.astro";
import CategoryFilter from "./CategoryFilter.astro";
import SearchBox from "./SearchBox.astro";
import Newsletter from "./Newsletter.astro";
import Pagination from "./Pagination.astro";
import { getCategories } from "../utils/categories";
import Icon from "./Icon.astro";

interface Props {
  articles: Array<{
    title: string;
    excerpt: string;
    category: string;
    date: string;
    readTime: string;
    image: string;
    slug: string;
  }>;
  currentPage: number;
  totalPages: number;
  totalPosts: number;
  headline: string;
  description: string;
  activeCategory?: string;
  baseUrl?: string;
}

const {
  articles,
  currentPage,
  totalPages,
  totalPosts,
  headline,
  description,
  activeCategory = "all",
  baseUrl,
} = Astro.props;

const categories = await getCategories();
---

<div class="w-full max-w-[1440px] mx-auto px-4 md:px-10 lg:px-20 py-10">
  <!-- Header Section -->
  <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-6">
    <div class="flex flex-col max-w-[700px]">
      <h2
        class="text-gray-900 dark:text-white tracking-tight text-3xl md:text-5xl font-extrabold leading-tight mb-4"
      >
        {headline}
      </h2>
      <p
        class="text-gray-600 dark:text-text-secondary-dark text-lg leading-relaxed"
      >
        {description}
      </p>
    </div>
  </div>

  <div class="flex flex-col lg:flex-row gap-12">
    <!-- Left Sidebar -->
    <aside
      class="w-full hidden lg:flex lg:w-1/4 flex-col gap-8 flex-shrink-0 sticky top-24 self-start"
    >
      <!-- Search -->
      <SearchBox />

      <!-- Categories -->
      <CategoryFilter activeCategory={activeCategory} />

      <!-- Newsletter -->
      <Newsletter />
    </aside>

    <!-- Main Content -->
    <main class="flex-1">
      <div class="lg:hidden">
        <SearchBox />
      </div>
      <!-- Mobile Category Filters -->
      <div class="flex gap-2 my-8 overflow-x-auto pb-2 lg:hidden no-scrollbar">
        {
          categories.map((category) => (
            <a
              href={
                category.slug === "all"
                  ? "/blog"
                  : `/blog?topic=${category.slug}`
              }
              class={`whitespace-nowrap h-8 px-4 rounded-full text-sm font-medium transition-colors ${
                activeCategory === category.slug
                  ? "bg-primary text-white shadow-sm"
                  : "bg-white dark:bg-surface-dark border border-gray-200 dark:border-border-dark text-gray-600 dark:text-text-secondary-dark hover:bg-gray-50 dark:hover:bg-gray-800"
              }`}
            >
              {category.name}
            </a>
          ))
        }
      </div>

      <!-- Articles Grid or No Results -->
      {
        articles.length > 0 ? (
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            {articles.map((article, index) => (
              <ArticleCard
                {...article}
                priority={index < 3 ? "high" : "auto"}
                loading={index < 3 ? "eager" : "lazy"}
              />
            ))}
          </div>
        ) : (
          <div class="flex flex-col items-center justify-center py-20 px-4 text-center bg-gray-50 dark:bg-surface-dark/30 rounded-3xl border-2 border-dashed border-gray-200 dark:border-border-dark">
            <div class="size-20 bg-gray-100 dark:bg-surface-dark rounded-full flex items-center justify-center text-gray-400 dark:text-text-secondary-dark mb-6">
              <Icon name="search_off" class="text-4xl" />
            </div>
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
              No results found
            </h3>
            <p class="text-gray-600 dark:text-text-secondary-dark max-w-md mb-8">
              We couldn't find any articles matching your current search or
              topic filters. Try adjusting your search or explore other topics.
            </p>
            <a
              href="/blog"
              class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white font-bold rounded-xl hover:bg-primary/90 transition-all shadow-md active:scale-95"
            >
              <Icon name="refresh" class="text-xl" />
              Clear All Filters
            </a>
          </div>
        )
      }

      <!-- Pagination -->
      {
        totalPages > 1 && (
          <Pagination
            currentPage={currentPage}
            totalPages={totalPages}
            baseUrl={baseUrl || (activeCategory === "all" ? "/blog" : `/blog`)}
            currentTopic={activeCategory}
            showInfo={true}
          />
        )
      }
    </main>

    <div class="lg:hidden">
      <Newsletter />
    </div>
  </div>
</div>
