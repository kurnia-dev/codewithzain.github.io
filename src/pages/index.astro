---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import BlogListing from "../components/BlogListing.astro";
import { formatDate } from "../utils/date";
import { HEADLINE, SITE_DESCRIPTION } from "../consts";

// Get all blog posts and sort by date (newest first)
const allPosts = await getCollection("blog");
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Pagination settings for page 1
const POSTS_PER_PAGE = 9;
const currentPage = 1;
const totalPosts = sortedPosts.length;
const totalPages = Math.ceil(totalPosts / POSTS_PER_PAGE);

// Get posts for page 1
const startIndex = (currentPage - 1) * POSTS_PER_PAGE;
const endIndex = startIndex + POSTS_PER_PAGE;
const currentPosts = sortedPosts.slice(startIndex, endIndex);

// Transform posts to match ArticleCard props
const articles = currentPosts.map((post) => ({
  title: post.data.title,
  excerpt: post.data.excerpt,
  category: post.data.category,
  date: formatDate(post.data.pubDate),
  readTime: post.data.readTime,
  image: post.data.image,
  slug: post.id,
}));
---

<BaseLayout title={HEADLINE} description={SITE_DESCRIPTION} currentPath="/">
  <BlogListing
    articles={articles}
    currentPage={currentPage}
    totalPages={totalPages}
    totalPosts={totalPosts}
    headline={HEADLINE}
    description={SITE_DESCRIPTION}
  />
</BaseLayout>
