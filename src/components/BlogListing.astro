---
import ArticleCard from "./ArticleCard.astro";
import CategoryFilter from "./CategoryFilter.astro";
import SearchBox from "./SearchBox.astro";
import Newsletter from "./Newsletter.astro";
import Pagination from "./Pagination.astro";
import { getCategories } from "../utils/categories";

interface Props {
  articles: Array<{
    title: string;
    excerpt: string;
    category: string;
    date: string;
    readTime: string;
    image: string;
    slug: string;
  }>;
  currentPage: number;
  totalPages: number;
  totalPosts: number;
  headline: string;
  description: string;
  activeCategory?: string;
  baseUrl?: string;
}

const {
  articles,
  currentPage,
  totalPages,
  totalPosts,
  headline,
  description,
  activeCategory = "all",
  baseUrl,
} = Astro.props;

const categories = await getCategories();
---

<div class="w-full max-w-[1440px] mx-auto px-4 md:px-10 lg:px-20 py-10">
  <!-- Header Section -->
  <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-6">
    <div class="flex flex-col max-w-[700px]">
      <h2
        class="text-gray-900 dark:text-white tracking-tight text-3xl md:text-5xl font-extrabold leading-tight mb-4"
      >
        {headline}
      </h2>
      <p
        class="text-gray-600 dark:text-text-secondary-dark text-lg leading-relaxed"
      >
        {description}
      </p>
    </div>
  </div>

  <div class="flex flex-col lg:flex-row gap-12">
    <!-- Left Sidebar -->
    <aside
      class="w-full hidden lg:flex lg:w-1/4 flex-col gap-8 flex-shrink-0 sticky top-24 self-start"
    >
      <!-- Search -->
      <SearchBox />

      <!-- Categories -->
      <CategoryFilter activeCategory={activeCategory} />

      <!-- Newsletter -->
      <Newsletter />
    </aside>

    <!-- Main Content -->
    <main class="flex-1">
      <div class="lg:hidden">
        <SearchBox />
      </div>
      <!-- Mobile Category Filters -->
      <div class="flex gap-2 my-8 overflow-x-auto pb-2 lg:hidden no-scrollbar">
        {
          categories.map((category) => (
            <a
              href={
                category.slug === "all"
                  ? "/blog"
                  : `/blog?topic=${category.slug}`
              }
              class={`whitespace-nowrap h-8 px-4 rounded-full text-sm font-medium transition-colors ${
                activeCategory === category.slug
                  ? "bg-primary text-white shadow-sm"
                  : "bg-white dark:bg-surface-dark border border-gray-200 dark:border-border-dark text-gray-600 dark:text-text-secondary-dark hover:bg-gray-50 dark:hover:bg-gray-800"
              }`}
            >
              {category.name}
            </a>
          ))
        }
      </div>

      <!-- Articles Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        {
          articles.map((article, index) => (
            <ArticleCard
              {...article}
              priority={index < 3 ? "high" : "auto"}
              loading={index < 3 ? "eager" : "lazy"}
            />
          ))
        }
      </div>

      <!-- Pagination -->
      {
        totalPages > 1 && (
          <Pagination
            currentPage={currentPage}
            totalPages={totalPages}
            baseUrl={baseUrl || (activeCategory === "all" ? "/blog" : `/blog`)}
            currentTopic={activeCategory}
            showInfo={true}
          />
        )
      }
    </main>

    <div class="lg:hidden">
      <Newsletter />
    </div>
  </div>
</div>
